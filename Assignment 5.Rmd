---
title: "Female academic trajectories (1967-2015)"
author: "Joanna Tang, Sandro Lallas, Rachem Behm"
date: "11/27/2018"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
# Outline

# 0. Load in packages and read in data
# 1a. Line graph with 6 lines: Total Males, Total Females, Full-time-males, Full-time-females, Part-time-males, Part-time-females, Public, Private-total
# 1b. Pairwise Chi-squared tests
# 2a. Bar graph, with 1 bar for each subject
# 2b. Pairwise Chi-squared tests
# 3a. Table for male vs female postdoc positions, male vs female non-postdoc positions
# 3b. Pairwise Mann-Whitney U + Cliff's Delta (effect size)
# 4. Multivariable LM

```


```{r include = FALSE}

# 0. Load packages and read in data

library(tidyverse)
library(vcdExtra)
library(knitr)
library(kableExtra)
library(RColorBrewer)
library(car)
library(effsize)
library(kableExtra)
library(formattable)
library(stargazer)

faculty_salary <- read_csv("Faculty salary data.csv") %>% rename("Years_since" = "Years Since PhD") %>% rename("Years" = "Years Faculty Service") %>% rename("Rank" = "Faculty Rank")
grad_enrollment <- read_csv("Grad enrollment.csv") %>% rename("Males" = "Total Males") %>% rename("Females" = "Total Females") %>% rename("Full_time_males" = "Full-time-males") %>% rename("Full_time_females" = "Full-time-females") %>% rename("Part_time_males" = "Part-time-males") %>% rename("Part_time_females" = "Part-time-females") %>% rename("Private_total" = "Private-total")
median_salary <- read_csv("Median salary for doctoral recipients.csv") %>% rename("Total_male" = "Total employment male") %>% rename("Total_female" = "Total employment femal") %>% rename("Postdoc_male" = "Postdoc male") %>% rename("Postdoc_female" = "Postdoc female")
phd_field <- read_csv("PhDs by Field.csv") %>% mutate(Percent = Proportion*100)

```



#INTRODUCTION

#METHODS

##Data Collection

##Statistical Analyses

All statistical analyses and figures were created in R (version 3.4.2).  Chi-squared tests were performed to analyze shifts in male and female graduate enrollment (1967-2015).  Chi-squared tests were performed to analyze shifts in female PhD recipients by field (1985, 2000, and 2015). Since our data for post-graduate starting salaries were not normally distributed, we used rank-based Mann-Whitney U tests to analyze significant differences between male and female salaries for starting postdoctoral and other employment positions (2015).


#RESULTS

##Male and female graduate enrollment (1967-2015)

```{r echo = FALSE, message = FALSE, warning= FALSE}

# 1a. Line graph with 2 lines: Total Males, Total Females + LM for each

grad_enrollment_total <- ggplot(grad_enrollment, aes(x = Year)) +
  geom_point(aes(y = Males), color = "red") +
    geom_smooth(method = lm, se = TRUE, color = "gray20", aes(y = Males)) +
  geom_point(aes(y = Females), color = "blue") +
    geom_smooth(method = lm, se = TRUE, color = "gray20", aes(y = Females)) +
  scale_x_continuous(expand = c(0.01, 0.01)) +
  scale_y_continuous(breaks = seq(200000, 1800000, by = 400000), lim = c(200000, 1800000), expand = c(0,0)) +
  xlab("Year") +
  ylab("Number of Students") +
  ggtitle("Graduate School Enrollment by Gender (1967-2015)") +
  theme_classic()

grad_enrollment_total




```

```{r include = FALSE}

# 1b. LM

grad_enrollment_males_lm <- lm(Males ~ Year, data = grad_enrollment)
summary(grad_enrollment_males_lm)

grad_enrollment_females_lm <-lm(Females ~ Year, data = grad_enrollment)
summary(grad_enrollment_females_lm)

grad_enrollment_males_pearsons <- cor.test(grad_enrollment$Year, grad_enrollment$Males)
grad_enrollment_males_pearsons

grad_enrollment_females_pearsons <- cor.test(grad_enrollment$Year, grad_enrollment$Females)
grad_enrollment_females_pearsons

```

Total graduate enrollment of both males and females increased from 1967 to 2015 (Fig. 1).  Male enrollment increased from 630,701 in 1967 to 1,221,566 in 2015.  Female enrollment increased from 265,364 in 1967 to 1,718,926 in 2015.  Most notably, up until 1988, total male enrollment exceeded total female enrollment; since 1988, total female enrollment has exceeded total male enrollment. The year significantly predicts male graduate enrollment (Pearsons R = .92). The overall model (Enrollment = 9,069 * Year - 17,112,153) explains a significant amount of variance in male graduate enrollment. F(1, 47) = 276, *p* < 0.001, R^2^ = 0.85. The year significantly predicts female graduate enrollment (Pearsons R = .99). The overall model (Enrollment = 30,126 * Year - 58,955,502) explains a significant amount of variance in female graduate enrollment. F(1, 47) = 2,669, *p* < 0.001, R^2^ = 0.98.




##Shifts in female PhD recipients

```{r echo = FALSE, message = FALSE, warning= FALSE}

# 2a. Bar graph with 1 bar for each subject

female_phd <- phd_field %>% 
  filter(Sex == "Female",
         Field == "Physical sciences and earth sciences" |
         Field == "Engineering" |
         Field == "Education" |
         Field == "Humanities and arts",
         Year == "1985" |
         Year == "2000" |
         Year == "2015")

female_phd_graph <- ggplot(female_phd, aes(x = Year)) +
  geom_col(aes(y = Number, fill = Field), position = "dodge") +
  scale_x_continuous(breaks = seq(1985, 2015, by = 15), expand = c(0, 0)) +
  scale_y_continuous(lim = c(0, 5000), expand = c(0,0)) +
  xlab("Year") +
  ylab("Number of Students") +
  ggtitle("Female PhD Recipients by Field") +
  theme_classic()

  
female_phd_graph

# Alternate graph based on field: female_phd_field_graph <- ggplot(female_phd, aes(x = Field,)) + geom_col(aes(y = Number, fill = as.factor(Year)), position = "dodge")

```

```{r include = FALSE}
# 2b. Pairwise Chi-squared tests

# Converting female_phd into contingency table

female_phd_contingency <- select(female_phd, "Field", "Number", "Year") %>%
  spread(Field, Number) %>% 
  select(-Year)

rownames(female_phd_contingency) <- c("1985", "2000", "2015")


female_phd_ed_chi <- chisq.test(select(female_phd_contingency, "Education"))
female_phd_ed_chi #chi2 (2) = 83.404, p < .001, year affects proportion

female_phd_eng_chi <- chisq.test(select(female_phd_contingency, "Engineering"))
female_phd_eng_chi #chi2 (2) = 2989.5, p < .001, year affects proportion

female_phd_ha_chi <- chisq.test(select(female_phd_contingency, "Humanities and arts"))
female_phd_ha_chi #chi2 (2) = 542, p < .001, year affects proportion

female_phd_pe_chi <- chisq.test(select(female_phd_contingency, "Physical sciences and earth sciences"))
female_phd_pe_chi #chi2 (2) = 880.67, p < .001, year affects proportion


```

The number of female PhD recipients in Education increased from 3,491 in 1985 to 4,179 in 2000, but then decreased to 3,502 in 2015 (Fig. 5).  This is the only field for which the number of recipients declined from 2000 to 2015.  Thus, there is a significant effect of year on the proportion of PhD recipients in Education (chi-squared (2) = 83.404, p < 0.001).

The number of female PhD recipients in Engineering increased from 198 in 1985, to 838 in 2000, to 2,301 in 2015 (Fig. 5).  Thus, there is a significant effect of year on the proportion of PhD recipients in Engineering (chi-squared (2) = 2989.5, p < 0.001).


The number of female PhD recipients in Humanities & Arts increased from 1,392 in 1985, to 2,672 in 2000, to 2,832 in 2015 (Fig. 5).  Thus, there is a significant effect of year on the proportion of PhD recipients in Humanities & Arts (chi-squared (2) = 542, p < 0.001).


The number of female PhD recipients in Physical & Earth Sciences increased from 569 in 1985, to 1,022 in 2000, to 1,988 in 2015 (Fig. 5).  Thus, there is a significant effect of year on the proportion of PhD recipients in Physical & Earth Sciences (chi-squared (2) = 880.67, p < 0.001).

##Male and female salaries for starting postdoctoral and other employment positions (2015)

```{r echo = FALSE, message = FALSE, warning= FALSE}

# 3a. Table for male vs female postdoc positions, male vs female non-postdoc positions


#Simplifying 
starting_salary <- median_salary %>% 
  summarize(
    median_female = median(Total_female),
    median_male = median(Total_male),
    se_female = sd(Total_female)/sqrt(length(Total_female)),
    se_male = sd(Total_male)/sqrt(length(Total_male))
  )
kable(starting_salary)

starting_salary_postdoc <- median_salary %>% 
  summarize(
    median_postdoc_female = median(Postdoc_female),
    median_postdoc_male = median(Postdoc_male),
    se_female = sd(Postdoc_female)/sqrt(length(Postdoc_female)),
    se_male = sd(Postdoc_male)/sqrt(length(Postdoc_male))
  )
kable(starting_salary_postdoc)

```

```{r include = FALSE}

# 3b. Pairwise Mann-Whitney U + Cliff's Delta (effect size)

starting_salary_mwu <- wilcox.test(median_salary$Total_male, median_salary$Total_female)
starting_salary_mwu #W = 136.5, p = .3289, medians the same

starting_salary_cliff <- cliff.delta(median_salary$Total_male, median_salary$Total_female)
starting_salary_cliff #delta = .213 (small)


starting_salary_postdoc_mwu <- wilcox.test(median_salary$Postdoc_male, median_salary$Postdoc_female)
starting_salary_postdoc_mwu #W = 117, p = .8671, medians the same

starting_salary_postdoc_cliff <- cliff.delta(median_salary$Postdoc_male, median_salary$Postdoc_female)
starting_salary_postdoc_cliff #delta = .04 (small)

```

Although the median starting postdoc positions for males (median =  48000) was higher than that for females (median = 45000) in our samples, such a difference was not significant (W = 136.5, p = 0.33, alpha = .05, Cliff’s delta = 21).  Thus, median salary does not differ significantly between male and female starting postdoc position salaries.

Although the median starting non-postdoc employment positions for males (median =  75167) was higher than that for females (median = 71750  in our samples, such a difference was not significant (W = 117, p = 0.86, alpha = .05, Cliff’s delta = .04).  Thus, median salary does not differ significantly between male and female starting non-postdoc employment position salaries.


##Academic salaries for professors in U.S. colleges

```{r include = FALSE}

# 4. Multivariable LM

faculty_salary$Rank <- fct_relevel(faculty_salary$Rank, "AsstProf")

faculty_salary_lm_sat <- lm(Salary ~ Sex + Rank + Years + Discipline + Years_since, data = faculty_salary)

summary(faculty_salary_lm_sat) #negative coefficient doesn't make sense

pairs_df <- select(faculty_salary, Years_since, Years, Salary)
pairs(pairs_df)

plot(faculty_salary_lm_sat)

faculty_salary_lm1 <- lm(Salary ~ Sex + Rank + Discipline + Years, data = faculty_salary)
summary(faculty_salary_lm1) #coefficient still negative

faculty_salary_lm2 <- lm(Salary ~ Sex + Rank + Discipline + Years_since, data = faculty_salary)
summary(faculty_salary_lm2)

aic_lm2 <- AIC(faculty_salary_lm2)
aic_lm2 #9097

faculty_salary_lm3 <- lm(Salary ~ Sex + Rank + Discipline, data = faculty_salary)
summary(faculty_salary_lm3)

aic_lm3 <- AIC(faculty_salary_lm3)
aic_lm3 #9095



```


```{r stargazer, echo = FALSE, results = 'asis'}

#Regression table of LMs

stargazer(faculty_salary_lm_sat, faculty_salary_lm2, faculty_salary_lm3, type = "html")

```

#DISCUSSION

##Female graduate enrollment is increasing over time
From 1967 to 2015, female graduate enrollment continually increased.  Total female enrollment increased more than total male enrollment.  Enrollment in public universities increased more than enrollment in private universities.  Full-time female enrollment increased more than full-time male enrollment.  Part-time female enrollment increased more than part-time male enrollment.

##Shifts in female PhD recipients over time
Since female graduate enrollment consistently increased over time, we were curious to explore if female enrollment increased in any particular field of study.

##Starting salaries for female PhD recipients in 2015
Since female graduate enrollment consistently increased over time, and increased more than male graduate enrollment, we were curious to explore if starting salaries for female PhD recipients differed from that of male PhD recipients.

##Academic salaries for US professors (2008-2009)

#CONCLUSION

#REFERENCES
